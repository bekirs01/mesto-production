(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function o(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(r){if(r.ep)return;r.ep=!0;const c=o(r);fetch(r.href,c)}})();const s={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"b81d4d4c-974c-43a8-8715-88637bbb457f","Content-Type":"application/json"}},d=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),R=()=>fetch(`${s.baseUrl}/users/me`,{headers:s.headers}).then(d),z=()=>fetch(`${s.baseUrl}/cards`,{headers:s.headers}).then(d),K=({name:e,about:t})=>fetch(`${s.baseUrl}/users/me`,{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e,about:t})}).then(d),G=e=>fetch(`${s.baseUrl}/users/me/avatar`,{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})}).then(d),Q=({name:e,link:t})=>fetch(`${s.baseUrl}/cards`,{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:t})}).then(d),X=e=>fetch(`${s.baseUrl}/cards/${e}`,{method:"DELETE",headers:s.headers}).then(d),Y=(e,t)=>fetch(`${s.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:s.headers}).then(d),Z=e=>{e.classList.toggle("card__like-button_is-active")},ee=e=>{e.remove()},te=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),U=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n,currentUserId:r})=>{const c=te(),i=c.querySelector(".card__like-button"),v=c.querySelector(".card__control-button_type_delete"),S=c.querySelector(".card__like-count");e.owner&&e.owner._id!==r&&v.remove();const b=c.querySelector(".card__image");return b.src=e.link,b.alt=e.name,c.querySelector(".card__title").textContent=e.name,S&&(S.textContent=e.likes?e.likes.length:0),e.likes&&e.likes.some(H=>H._id===r)&&i.classList.add("card__like-button_is-active"),o&&i.addEventListener("click",()=>o(e._id,i,S)),n&&v&&(!e.owner||e.owner._id===r)&&v.addEventListener("click",()=>n(e._id,c)),t&&b.addEventListener("click",()=>t({name:e.name,link:e.link})),c},$=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");a(t)}},_=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",$)},a=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",$)},oe=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{a(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&a(e)})};function A(e,t,o,n){const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}function F(e,t,o){const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.textContent="",n.classList.remove(o.errorClass)}function re(e,t,o){t.validity.valid?F(e,t,o):t.validity.patternMismatch?A(e,t,t.dataset.errorMessage,o):A(e,t,t.validationMessage,o)}function ne(e){return e.some(t=>!t.validity.valid)}function M(e,t){e.disabled=!0,e.classList.add(t.inactiveButtonClass)}function ce(e,t){e.disabled=!1,e.classList.remove(t.inactiveButtonClass)}function w(e,t,o){ne(e)?M(t,o):ce(t,o)}function se(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);w(o,n,t),o.forEach(r=>{r.addEventListener("input",()=>{re(e,r,t),w(o,n,t)})})}function L(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>{F(e,r,t)}),M(n,t)}function le(e){Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{se(o,e)})}const T=document.querySelector(".places__list"),q=document.querySelector(".popup_type_edit"),f=q.querySelector(".popup__form"),O=f.querySelector(".popup__input_type_name"),D=f.querySelector(".popup__input_type_description"),C=document.querySelector(".popup_type_new-card"),u=C.querySelector(".popup__form"),ie=u.querySelector(".popup__input_type_card-name"),ae=u.querySelector(".popup__input_type_url"),g=document.querySelector(".popup_type_image"),x=g.querySelector(".popup__image"),ue=g.querySelector(".popup__caption"),de=document.querySelector(".profile__edit-button"),pe=document.querySelector(".profile__add-button"),k=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),I=document.querySelector(".profile__image"),B=document.querySelector(".popup_type_edit-avatar"),p=B.querySelector(".popup__form"),_e=p.querySelector(".popup__input"),P=document.querySelector(".popup_type_remove-card"),N=P.querySelector(".popup__form"),W=({name:e,link:t})=>{x.src=t,x.alt=e,ue.textContent=e,_(g)},fe=e=>{e.preventDefault();const t=f.querySelector(".popup__button");l(!0,t,"Сохранить","Сохранение..."),K({name:O.value,about:D.value}).then(o=>{k.textContent=o.name,E.textContent=o.about,a(q)}).catch(o=>{console.log(o)}).finally(()=>{l(!1,t,"Сохранить","Сохранение...")})},me=e=>{e.preventDefault();const t=p.querySelector(".popup__button");l(!0,t,"Сохранить","Сохранение..."),G(_e.value).then(o=>{I.style.backgroundImage=`url(${o.avatar})`,a(B),p.reset()}).catch(o=>{console.log(o)}).finally(()=>{l(!1,t,"Сохранить","Сохранение...")})};let j,m=null,y=null;const ye=e=>{e.preventDefault();const t=u.querySelector(".popup__button");l(!0,t,"Создать","Создание..."),Q({name:ie.value,link:ae.value}).then(o=>{T.prepend(U(o,{onPreviewPicture:W,onLikeIcon:V,onDeleteCard:J,currentUserId:j})),u.reset(),a(C)}).catch(o=>{console.log(o)}).finally(()=>{l(!1,t,"Создать","Создание...")})},he=e=>{e.preventDefault();const t=N.querySelector(".popup__button");if(l(!0,t,"Да","Сохранение..."),!m||!y){l(!1,t,"Да","Сохранение...");return}X(m).then(()=>{ee(y),a(P),m=null,y=null}).catch(o=>{console.log(o)}).finally(()=>{l(!1,t,"Да","Сохранение...")})};f.addEventListener("submit",fe);u.addEventListener("submit",ye);p.addEventListener("submit",me);N.addEventListener("submit",he);de.addEventListener("click",()=>{O.value=k.textContent,D.value=E.textContent,L(f,h),_(q)});I.addEventListener("click",()=>{p.reset(),L(p,h),_(B)});pe.addEventListener("click",()=>{u.reset(),L(u,h),_(C)});const ve=document.querySelectorAll(".popup");ve.forEach(e=>{oe(e)});const h={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};le(h);Promise.all([z(),R()]).then(([e,t])=>{k.textContent=t.name,E.textContent=t.about,I.style.backgroundImage=`url(${t.avatar})`,j=t._id,e.forEach(o=>{T.append(U(o,{onPreviewPicture:W,onLikeIcon:V,onDeleteCard:J,currentUserId:t._id}))})}).catch(e=>{console.log(e)});function J(e,t){m=e,y=t,_(P)}function V(e,t,o){const n=t.classList.contains("card__like-button_is-active");Y(e,n).then(r=>{Z(t),o&&(o.textContent=r.likes.length)}).catch(r=>{console.log(r)})}function l(e,t,o,n){e===!0?t.textContent=n:t.textContent=o}
